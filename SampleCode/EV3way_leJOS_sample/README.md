# EV3way-ET 用のサンプルログラム

ETロボコン向け走行体 EV3Wway-ET のサンプル Java プログラムです。

## 1 概要

EV3way-ET 用のサンプル Java ログラムです。本サンプルプログラムは leJOS EV3 という
LEGO MINDSTORMS EV3 用 Java 開発環境の利用を前提としており、 サンプルプログラムの
使用には leJOS EV3 開発環境の構築が必要となります。

## 2 leJOS EV3 EV3開発環境の構築方法

leJOS EV3 開発環境の構築方法については、ETロボコン実行委員会で用意したWebサイトを
参照してください。

    ETロボコン EV3開発環境構築ガイド： https://github.com/ETrobocon/etroboEV3/wiki

## 3 サンプルログラム

サンプルプログラムを leJOS EV3 統合開発環境である eclipse で利用するには、まず eclispse
上で新規プロジェクト leJOS EV3 Project を適当な名前をつけて作成します。その後、左側ペインに
あるパッケージ・エクスプローラから作成したプロジェクトを展開し、現れた src に、ダウンロード
したサンプルの src フォルダ配下のもの(すなわち jp フォルダ)をドラッグします。ダイアログが
現れたらそのまま OK ボタンをクリックしてください。以上でプロジェクトへのソースの取り込みは
完了です。

本サンプルプログラムは以下の３種類のプログラムがあるので、それぞれにプロジェクトを作成してください。

* `ev3sample`
  - 二輪倒立でライントレースを行います
  - ETロボコン2018より採用されたタイヤ(通称: デカタイヤ)に対応しています
  - eclipse上からは「実行 ▶ 3. LeJOS EV3 Program」で実行してください
* `ev3sample_L7`
  - ev3sample の2017年まで使われていたサンプルプログラムです
* pcsample
  - PCからリモートでEV3のライントレースを開始/停止するプログラムです
  - eclipse 上からは「実行 ▶ 1. Java アプリケーション」で実行してください

### 4 走行体の配線

本サンプルプログラムは、モータとセンサが以下のようにEV3本体に配線されていることを前提に
しています。

| デバイス    | 接続ポート |
|:-----------|:---------|
| 左駆動モータ | ポートC |
| 右駆動モータ | ポートB |
| 尻尾モータ   | ポートA |
| タッチセンサ | ポート１ |
| 超音波センサ | ポート２ |
| カラーセンサ | ポート３ |
| ジャイロセンサ | ポート４ |

## 5 使用手順

以下に eclipse 上からサンプルプログラムを実行する手順を示します。予めPC からEV3走行体に
プログラムを転送できるように USB ケーブル、Bluetooth、Wi-fi などで接続しておいてください。

1. 尻尾(完全停止時に走行体を支える部分)の先端部がモータに付くよう一番上にあげておいてください。
1. eclipse の左側のペインのパッケージ・エクスプローラからev3sample のプロジェクトを選択し、右クリックで現れるメニューから「実行 ▶ 3. LeJOS EV3 Program」を選択してください。自動的にコンパイル済のプログラムが走行体に転送・実行されます。
1. 走行体のLCD に “Please wait” と表示されたら、走行体を静止した状態でしばらく待ってください。この間にジャイロセンサのリセットが行われるので、静止しておかないと以後の倒立振子制御がうまくいかなくなります。
1. 尻尾が完全停止の角度になるので、ライントレースを行うコース上に設置します。
1. PC からリモートでスタートさせる場合は、eclipse の左側のペインのパッケージ・エクスプローラからpcsample のプロジェクトを選択し、右クリックで現れるメニューから「実行 ▶ 1. Java アプリケーション」を選択してください。リモート操作用のウィンドウ「LeJOS EV3 Client Sample」がPC 上に現れます。「LeJOS EV3 Client Sample」の [Connect] ボタンをクリックします。
1. PC の「LeJOS EV3 Client Sample」をアクティブにし、PC のキーボードから「g」を入力するか、走行体のタッチセンサを押下することにより、走行体がライントレースを開始します。
1. PC の「LeJOS EV3 Client Sample」をアクティブにし、PC のキーボードから「s」を入力するか、EV3のタッチセンサを押下することにより、ライントレースを中断し、プログラムを終了します。
